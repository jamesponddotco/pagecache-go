---
image: 'archlinux'
packages:
  - 'go'
  - 'make'
sources:
  - https://git.sr.ht/~jamesponddotco/pagecache-go
environment:
  PATH: "{HOME}/go/bin:{PATH}"
tasks:
  - setup: |
      cd pagecache-go
      export PATH="{HOME}/go/bin:{PATH}"
      go install mvdan.cc/gofumpt@v0.5.0
      go install github.com/golangci/golangci-lint/cmd/golangci-lint@v1.52.2
      go install golang.org/x/vuln/cmd/govulncheck@latest
  - lint: |
      cd pagecache-go
      export PATH="{HOME}/go/bin:{PATH}"
      golangci-lint run ./...
  - test: |
      cd pagecache-go
      export PATH="{HOME}/go/bin:{PATH}"
      go test -cover -race -vet all ./...
